<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>My Purchase</title>
    <style>
        @import url(//cdnjs.cloudflare.com/ajax/libs/normalize/3.0.1/normalize.min.css);
        @import url(//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css);
    </style>
    <!-- Include Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.1/firebase-firestore.js"></script>
    <!-- Include JsBarcode library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js" integrity="sha512-QEAheCz+x/VkKtxeGoDq6nsGyzTx/0LMINTgQjqZ0h3+NjP+bCsPYz3hn0HnBkGmkIFSr7QcEZT+KyEM7lbLPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <h1>My Purchase</h1>
    <form onsubmit="return fetchPurchase()">
        <label for="phoneNumber">Enter your phone number:</label>
        <input type="text" id="phoneNumber" name="phoneNumber" required>
        <button type="submit">Submit</button>
    
    </form>
    <canvas id="barcodeContainer"></canvas>
    

    <script>
        
        var firebaseConfig = {
                apiKey: "AIzaSyBo8djp3hGPhsB-96McKlhXZf1A05ZXHo8",
                authDomain: "devops-10d92.firebaseapp.com",
                databaseURL: "https://devops-10d92-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "devops-10d92",
                storageBucket: "devops-10d92.appspot.com",
                messagingSenderId: "658512427596",
                appId: "1:658512427596:web:7c952bea1f04f6abc312e9",
                measurementId: "G-FPX12XED41"
            };
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            db.settings({
                timestampsInSnapshots: true,
                merge: true
            });

        async function fetchPurchase() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            try {
                const docRef = doc(db, "test", phoneNumber);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists) {
                    // Retrieve barcode data from Firestore document
                    if (docSnap.data().hasOwnProperty("barcode")) {
                        const barcodeData = docSnap.data().barcode;
                        console.log(`Value of field 'barcode' in document '${phoneNumber}': ${barcodeData}`);
                    
                        // Display barcode using JsBarcode
                        JsBarcode("#barcodeContainer", barcodeData.toString());
                    } else {
                        alert("No barcode found for this phone number.");
                    }
                } else {
                    alert("No purchase found for this phone number.");
                }
            } catch (error) {
                console.error("Error fetching document: ", error);
                alert("An error occurred while fetching data. Please try again later.");
            }
            return false; // Prevent form submission
        }
    </script>
</body>

</html>
