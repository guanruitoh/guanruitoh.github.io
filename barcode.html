<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Submission</title>

    <!-- Add Firebase scripts -->
    <script defer src="https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.6.3/firebase-database.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.6.3/firebase-analytics.js"></script>

    <!-- Add JsBarcode library -->
    <script defer src="https://cdn.jsdelivr.net/jsbarcode/3.11.0/JsBarcode.all.min.js"></script>

    <!-- Your Firebase configuration and initialization code -->
    <script defer>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBo8djp3hGPhsB-96McKlhXZf1A05ZXHo8",
            authDomain: "devops-10d92.firebaseapp.com",
            projectId: "devops-10d92",
            storageBucket: "devops-10d92.appspot.com",
            messagingSenderId: "658512427596",
            appId: "1:658512427596:web:7c952bea1f04f6abc312e9",
            measurementId: "G-FPX12XED41"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
</head>
<body>
    <form id="barcodeForm">
        <label for="barcode">Generated Barcode:</label>
        <svg id="barcodeSvg"></svg>

        <label for="barcodeInput">Custom Barcode:</label>
        <input type="text" id="barcodeInput" name="barcodeInput" required>

        <button type="button" onclick="generateBarcode()">Generate Barcode</button>
        <button type="button" onclick="submitBarcode()">Submit Barcode</button>
    </form>

    <script>
        function generateBarcode() {
            // Generate a random barcode
            var randomBarcode = Math.floor(Math.random() * 900000000) + 100000000;

            // Display the generated barcode in the SVG
            JsBarcode("#barcodeSvg", randomBarcode.toString(), { format: "CODE128" });

            // Set the generated barcode in the input field
            document.getElementById('barcodeInput').value = randomBarcode.toString();
        }

        function submitBarcode() {
            var barcodeInput = document.getElementById('barcodeInput').value;

            // Push barcode data to the 'barcodes' node in the database
            firebase.database().ref('barcodes').push({
                barcode: barcodeInput
            }, function(error) {
                if (error) {
                    alert('Barcode submission failed. Please try again.');
                } else {
                    // Redirect to thanks_for_purchase.html with the generated barcode
                    window.location.href = 'thanks_for_purchase.html?barcode=' + barcodeInput;
                }
            });
        }
    </script>
</body>
</html>
